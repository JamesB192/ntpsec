from waflib import Utils

def build(ctx):
	srcnode = ctx.srcnode.abspath()
	bldnode = ctx.bldnode.abspath()

	util = ['hist', 'jitter', 'precision', 'propdelay',
		'sht', 'testrs6000', 'tg2']

	if ctx.env.PLATFORM_TARGET != "freebsd": # XXX: fix this using a test in configure().
		util += ["pps-api", "ntptime"]

	if ctx.env.HAVE_ADJTIMEX:
		util += ["ntptickadj"]

	for name in util:
		ctx(
			target		= name,
			features	= "c cprogram bld_include src_include libisc_include",
			source		= [name + ".c"],
			includes	= [
						"%s/%s/" % (bldnode, name)
					],
			use		= "ntp opts isc M RT PTHREAD",
			install_path = "${PREFIX}/bin/"
		)


